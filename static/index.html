<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AstroGuru AI - Vedic Astrology Analysis</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Navigation Bar -->
        <nav class="navbar" id="navbar" style="display: none;">
            <div class="nav-content">
                <div class="nav-brand">
                    <h1>‚ú® AstroGuru AI</h1>
                </div>
                <div class="nav-links">
                    <a href="#" onclick="showDashboard(); return false;" id="dashboardLink">Dashboard</a>
                    <a href="#" onclick="showForm(); return false;" id="newAnalysisLink">New Analysis</a>
                    <div class="user-menu" id="userMenu">
                        <span id="userName">User</span>
                        <button class="btn-link" onclick="authManager.logout()">Logout</button>
                    </div>
                </div>
            </div>
        </nav>

        <header id="header">
            <h1>‚ú® AstroGuru AI</h1>
            <p class="subtitle">Your Personal Vedic Astrology Guide</p>
        </header>

        <div class="main-content">
            <!-- Welcome Page -->
            <div class="welcome-page" id="welcomePage" style="display: none;">
                <div class="welcome-content">
                    <h2>Welcome to Vedic Astrology</h2>
                    <div class="welcome-text">
                        <p>Vedic Astrology, also known as Jyotish, is an ancient Indian system of astrology that has been practiced for thousands of years. It offers profound insights into your life's journey, personality, relationships, career, and spiritual growth.</p>
                        <p>Our AI-powered analysis combines traditional Vedic principles with modern technology to provide you with:</p>
                        <ul>
                            <li><strong>Birth Chart Analysis:</strong> Understanding your planetary positions and their influence</li>
                            <li><strong>Dasha Periods:</strong> Insights into your current life phase and upcoming transitions</li>
                            <li><strong>Goal-Specific Guidance:</strong> Personalized advice for career, relationships, health, and more</li>
                            <li><strong>Remedies & Recommendations:</strong> Practical steps to enhance positive energies</li>
                        </ul>
                        <p>Get started by filling out your birth details below. Our AI will analyze your chart and provide comprehensive insights tailored to your unique astrological profile.</p>
                    </div>
                    <button class="btn-primary btn-large" onclick="showForm()">
                        Start Your Analysis
                    </button>
                </div>
            </div>

            <!-- Auth Required -->
            <div class="auth-required" id="authRequired" style="display: none;">
                <div class="auth-required-content">
                    <h2>Welcome to AstroGuru AI</h2>
                    <p>Please login to continue</p>
                    <button class="btn-primary" onclick="authManager.initiateGoogleLogin()">
                        <span>üîê Login with Google</span>
                    </button>
                </div>
            </div>

            <!-- Dashboard -->
            <div class="dashboard-container" id="dashboardContainer" style="display: none;">
                <div class="dashboard-header">
                    <h2>My Dashboard</h2>
                </div>
                <div class="dashboard-content">
                    <div class="user-profile" id="userProfile">
                        <div class="profile-info">
                            <img id="userPicture" src="" alt="Profile" class="profile-picture" style="display: none;">
                            <div>
                                <h3 id="profileName">User</h3>
                                <p id="profileEmail">email@example.com</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabbed Interface -->
                    <div class="dashboard-tabs">
                        <div class="tab-buttons">
                            <button class="tab-button active" id="chatQueriesTab" onclick="switchTab('chatQueries')">
                                <span>üí¨ Chat Queries</span>
                            </button>
                            <button class="tab-button" id="fullReportsTab" onclick="switchTab('fullReports')">
                                <span>üìä Full Reports</span>
                            </button>
                        </div>
                        
                        <div class="tab-content">
                            <div class="tab-pane active" id="chatQueriesPane">
                                <div class="orders-section">
                                    <h3>Chat Queries</h3>
                                    <div id="chatQueriesList" class="orders-list">
                                        <div class="loading">Loading chat queries...</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="tab-pane" id="fullReportsPane">
                                <div class="orders-section">
                                    <h3>Full Reports</h3>
                                    <div id="fullReportsList" class="orders-list">
                                        <div class="loading">Loading full reports...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Form -->
            <div class="form-container" id="formContainer" style="display: none;">
                <h2>Enter Your Birth Details</h2>
                <form id="birthForm">
                    <div class="form-group">
                        <label for="orderType">Order Type *</label>
                        <select id="orderType" name="orderType" required onchange="handleOrderTypeChange()">
                            <option value="full_report">Full Report</option>
                            <option value="query">Query (Ask a Question)</option>
                        </select>
                        <small id="orderTypeHelp" class="help-text">Full Report provides comprehensive analysis. Query allows you to ask specific questions.</small>
                    </div>

                    <div class="form-group" id="queryGroup" style="display: none;">
                        <label for="userQuery">Your Question *</label>
                        <textarea id="userQuery" name="userQuery" rows="3" placeholder="Enter your astrology question here..."></textarea>
                        <small class="help-text">Ask a specific question about your horoscope, career, relationships, health, etc.</small>
                    </div>

                    <div class="form-group">
                        <label for="name">Full Name *</label>
                        <input type="text" id="name" name="name" required placeholder="Enter your full name">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="dateOfBirth">Date of Birth *</label>
                            <input type="date" id="dateOfBirth" name="dateOfBirth" required>
                        </div>

                        <div class="form-group">
                            <label for="timeOfBirth">Time of Birth * (IST)</label>
                            <input type="time" id="timeOfBirth" name="timeOfBirth" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="placeOfBirth">Place of Birth *</label>
                        <div class="autocomplete-wrapper">
                            <input type="text" id="placeOfBirth" name="placeOfBirth" required 
                                   placeholder="City, State, Country" autocomplete="off">
                            <div id="suggestions" class="suggestions"></div>
                        </div>
                        <small>Start typing to see location suggestions</small>
                        <input type="hidden" id="latitude" name="latitude">
                        <input type="hidden" id="longitude" name="longitude">
                    </div>

                    <div class="form-group">
                        <label for="goals">Your Goals *</label>
                        <div class="checkbox-group" id="goalsGroup">
                            <label><input type="checkbox" name="goals" value="career"> Career</label>
                            <label><input type="checkbox" name="goals" value="marriage"> Marriage</label>
                            <label><input type="checkbox" name="goals" value="health"> Health</label>
                            <label><input type="checkbox" name="goals" value="finance"> Finance</label>
                            <label><input type="checkbox" name="goals" value="education"> Education</label>
                            <label><input type="checkbox" name="goals" value="love life"> Love Life</label>
                        </div>
                    </div>

                    <button type="submit" class="btn-primary" id="submitBtn">
                        <span class="btn-text" id="submitBtnText">Pay and Generate</span>
                        <span class="btn-loader" style="display: none;">Processing...</span>
                    </button>
                    <div id="priceDisplay" class="price-display" style="margin-top: 16px; text-align: center; font-weight: 600; color: var(--primary-color);">
                        Price: ‚Çπ<span id="priceAmount">10.00</span>
                    </div>
                </form>
            </div>

            <!-- Chat Interface -->
            <div class="chat-container" id="chatContainer" style="display: none;">
                <div class="chat-header">
                    <h2>Chat</h2>
                    <button class="btn-secondary" onclick="showDashboard()">Back to Dashboard</button>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="loading">Loading chat history...</div>
                </div>
                <div class="chat-input-container" id="chatInputContainer">
                    <div class="message-limit-info" id="messageLimitInfo"></div>
                    <div class="chat-input-wrapper">
                        <textarea id="chatInput" placeholder="Type your message..." rows="2"></textarea>
                        <button class="btn-primary" id="sendChatBtn" onclick="sendChatMessage()">Send</button>
                    </div>
                </div>
            </div>

            <!-- Payment Success Page -->
            <div class="payment-success" id="paymentSuccess" style="display: none;">
                <div class="success-content">
                    <div class="success-icon">‚úÖ</div>
                    <h2>Payment Successful!</h2>
                    <p>Your payment has been processed successfully. Your astrology report will be emailed to you once the analysis is complete.</p>
                    <p class="info-text">This usually takes 3-5 minutes. You can also check your dashboard for updates.</p>
                    <div class="success-actions">
                        <button class="btn-primary" onclick="showDashboard()">Go to Dashboard</button>
                        <button class="btn-secondary" onclick="showForm()">New Analysis</button>
                    </div>
                </div>
            </div>

            <!-- Payment Failure Page -->
            <div class="payment-failure" id="paymentFailure" style="display: none;">
                <div class="failure-content">
                    <div class="failure-icon">‚ùå</div>
                    <h2>Payment Failed</h2>
                    <p id="paymentErrorMsg">Your payment could not be processed. Please try again.</p>
                    <div class="failure-actions">
                        <button class="btn-primary" onclick="retryPayment()">Retry Payment</button>
                        <button class="btn-secondary" onclick="showDashboard()">Go to Dashboard</button>
                    </div>
                </div>
            </div>

            <!-- Results Container (for viewing completed analysis) -->
            <div class="results-container" id="resultsContainer" style="display: none;">
                <div class="results-header">
                    <h2>Your Astrology Report</h2>
                    <button class="btn-secondary" onclick="showDashboard()">Back to Dashboard</button>
                </div>

                <div class="analysis-sections" id="analysisSections">
                    <div class="section" id="summarySection" style="display: none;">
                        <h3>üìã Your Astrology Report</h3>
                        <div class="section-content" id="summaryContent"></div>
                    </div>

                    <div class="expandable-sections" id="expandableSections" style="display: none;">
                        <button class="btn-toggle" id="toggleDetailsBtn">
                            <span>Show Detailed Analysis</span>
                            <span style="display: none;">Hide Detailed Analysis</span>
                        </button>

                        <div class="detailed-sections" id="detailedSections" style="display: none;">
                            <div class="section" id="chartSection" style="display: none;">
                                <h3>üìä Birth Chart Analysis</h3>
                                <div class="section-content" id="chartContent"></div>
                            </div>

                            <div class="section" id="dashaSection" style="display: none;">
                                <h3>‚è∞ Current Life Period (Dasha)</h3>
                                <div class="section-content" id="dashaContent"></div>
                            </div>

                            <div class="section" id="goalSection" style="display: none;">
                                <h3>üéØ Goal-Specific Analysis</h3>
                                <div class="section-content" id="goalContent"></div>
                            </div>

                            <div class="section" id="recommendationsSection" style="display: none;">
                                <h3>üí° Recommendations & Remedies</h3>
                                <div class="section-content" id="recommendationsContent"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Powered by AstroGuru AI | Vedic Astrology Analysis</p>
        </footer>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="spinner"></div>
        <p id="loadingText">Loading...</p>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <script src="/static/auth.js"></script>
    <script src="/static/app.js"></script>
    <script src="/static/dashboard.js"></script>
    <script src="/static/chat.js"></script>
</body>
</html>
